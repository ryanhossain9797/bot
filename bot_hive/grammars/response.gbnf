# GBNF Grammar for Bot Response with Tool Calls (Serde externally tagged enums)
# Schema: {
#   "updated_summary": string,
#   "outcome": {"Final": {"response": string}} | {"IntermediateToolCall": {"maybe_intermediate_response": string | null, "tool_call": {"DeviceControl": {device, property, value}}}}
# }
# MessageOutcome enum (Serde's default externally tagged format for nested enums)

root ::= object
object ::= "{" ws "\"updated_summary\"" ws ":" ws string "," ws "\"outcome\"" ws ":" ws outcome-object "}" ws

# MessageOutcome is an externally tagged enum
outcome-object ::= final-outcome | intermediate-tool-call-outcome

# Final outcome: {"Final": {"response": "..."}}
final-outcome ::= "{" ws "\"Final\"" ws ":" ws final-value "}" ws
final-value ::= "{" ws "\"response\"" ws ":" ws string "}" ws

# IntermediateToolCall outcome: {"IntermediateToolCall": {"maybe_intermediate_response": ... | null, "tool_call": {...}}}
intermediate-tool-call-outcome ::= "{" ws "\"IntermediateToolCall\"" ws ":" ws intermediate-tool-call-value "}" ws
intermediate-tool-call-value ::= "{" ws "\"maybe_intermediate_response\"" ws ":" ws optional-string "," ws "\"tool_call\"" ws ":" ws tool-call-object "}" ws

# Optional string (null or string)
optional-string ::= null | string

# ToolCall is an externally tagged enum
tool-call-object ::= device-control-tool-call | get-weather-tool-call

# DeviceControl tool call: {"DeviceControl": {device, property, value}}
device-control-tool-call ::= "{" ws "\"DeviceControl\"" ws ":" ws device-control-value "}" ws

# DeviceControl struct fields
device-control-value ::= "{" ws "\"device\"" ws ":" ws string "," ws "\"property\"" ws ":" ws string "," ws "\"value\"" ws ":" ws value "}" ws

# GetWeather tool call: {"GetWeather": {location}}
get-weather-tool-call ::= "{" ws "\"GetWeather\"" ws ":" ws get-weather-value "}" ws

# GetWeather struct fields
get-weather-value ::= "{" ws "\"location\"" ws ":" ws string "}" ws

# Value can be either string or number
value ::= string | number

# Basic JSON types
string ::= "\"" ([^"\\\x7F\x00-\x1F] | "\\" (["\\bfnrt] | "u" [0-9a-fA-F] [0-9a-fA-F] [0-9a-fA-F] [0-9a-fA-F]))* "\""
number ::= ("-"? ([0-9] | [1-9] [0-9]*)) ("." [0-9]+)? ([eE] [-+]? [0-9]+)?
null ::= "null"
ws ::= [ \t\n]*
