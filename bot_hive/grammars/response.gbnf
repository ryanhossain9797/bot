# GBNF Grammar for Bot Response with Tool Calls (Serde externally tagged enums)
# Schema: {
#   "outcome": {"Final": {"response": string}} | {"IntermediateToolCall": {"maybe_intermediate_response": string | null, "tool_call": {"GetWeather": {location}}}}
# }
# LLMDecisionType enum (Serde's default externally tagged format for nested enums)

root ::= object
object ::= "{" ws "\"outcome\"" ws ":" ws outcome-object "}" ws

# MessageOutcome is an externally tagged enum
outcome-object ::= final-outcome | intermediate-tool-call-outcome

# Final outcome: {"Final": {"response": "..."}}
final-outcome ::= "{" ws "\"Final\"" ws ":" ws final-value "}" ws
final-value ::= "{" ws "\"response\"" ws ":" ws string "}" ws

# IntermediateToolCall outcome: {"IntermediateToolCall": {"maybe_intermediate_response": ... | null, "tool_call": {...}}}
intermediate-tool-call-outcome ::= "{" ws "\"IntermediateToolCall\"" ws ":" ws intermediate-tool-call-value "}" ws
intermediate-tool-call-value ::= "{" ws "\"maybe_intermediate_response\"" ws ":" ws optional-string "," ws "\"tool_call\"" ws ":" ws tool-call-object "}" ws

# Optional string (null or string)
optional-string ::= null | string

# ToolCall is an externally tagged enum
tool-call-object ::= get-weather-tool-call

# GetWeather tool call: {"GetWeather": {location}}
get-weather-tool-call ::= "{" ws "\"GetWeather\"" ws ":" ws get-weather-value "}" ws

# GetWeather struct fields
get-weather-value ::= "{" ws "\"location\"" ws ":" ws string "}" ws

# Basic JSON types
# String with robust UTF-8 support (allows multi-byte characters like Bangla)
string ::= "\"" string-char* "\""
string-char ::= [^"\\\x00-\x1F] | "\\" escape-char
escape-char ::= ["\\bfnrt/] | "u" [0-9a-fA-F] [0-9a-fA-F] [0-9a-fA-F] [0-9a-fA-F]
number ::= ("-"? ([0-9] | [1-9] [0-9]*)) ("." [0-9]+)? ([eE] [-+]? [0-9]+)?
null ::= "null"
ws ::= [ \t\n]*
